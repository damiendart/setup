# {{ ansible_managed }}
#
# This file was written by Damien Dart, <damiendart@pobox.com>. This is
# free and unencumbered software released into the public domain. For
# more information, please refer to the accompanying "UNLICENCE file.


set alert {{ EMAIL_ADDRESS }}

set httpd port 2812 and
  use address localhost
  allow localhost

set mail-format { from: {{ EMAIL_ADDRESS }} }

set mailserver {{ EMAIL_HOST }} port 587
  username "{{ EMAIL_ADDRESS }}" password "{{ EMAIL_PASSWORD }}"
  using TLSV1 with timeout 30 seconds

check file ssh_logins with path /var/log/auth.log
  if match "Accepted publickey" then alert

# One day I will do this properly and use the "conf-enabled" thing.
# include /etc/monit/conf-available/apache2
include /etc/monit/conf-available/cron
include /etc/monit/conf-available/openssh-server
